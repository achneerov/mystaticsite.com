<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>My Spotify Stats</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #1db954, #191414);
                color: white;
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .header {
                text-align: center;
                margin-bottom: 40px;
            }

            .header h1 {
                font-size: 3rem;
                margin-bottom: 10px;
                color: #1db954;
            }

            .upload-container {
                background: rgba(25, 20, 20, 0.9);
                border-radius: 15px;
                padding: 40px;
                text-align: center;
                border: 2px dashed #1db954;
                margin: 40px auto;
                max-width: 600px;
                transition: all 0.3s ease;
            }

            .upload-container:hover {
                border-color: #1ed760;
                background: rgba(25, 20, 20, 0.95);
            }

            .upload-container.dragover {
                border-color: #1ed760;
                background: rgba(29, 185, 84, 0.1);
                transform: scale(1.02);
            }

            .upload-icon {
                font-size: 4rem;
                margin-bottom: 20px;
                color: #1db954;
            }

            .upload-text {
                font-size: 1.2rem;
                margin-bottom: 20px;
            }

            .upload-input {
                display: none;
            }

            .upload-button {
                background: #1db954;
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 25px;
                font-size: 1.1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                margin: 10px;
            }

            .upload-button:hover {
                background: #1ed760;
                transform: translateY(-2px);
            }

            .back-button {
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid #1db954;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-bottom: 20px;
            }

            .back-button:hover {
                background: rgba(29, 185, 84, 0.2);
            }

            .processing {
                text-align: center;
                font-size: 1.5rem;
                margin: 50px 0;
            }

            .processing-steps {
                margin-top: 20px;
                text-align: left;
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
            }

            .processing-step {
                padding: 10px;
                margin: 5px 0;
                border-radius: 5px;
                transition: all 0.3s ease;
            }

            .processing-step.active {
                background: rgba(29, 185, 84, 0.2);
                border-left: 3px solid #1db954;
            }

            .processing-step.completed {
                background: rgba(29, 185, 84, 0.1);
                color: #1db954;
            }

            .loading {
                text-align: center;
                font-size: 1.5rem;
                margin: 50px 0;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 40px;
            }

            .stat-card {
                background: rgba(25, 20, 20, 0.8);
                border-radius: 10px;
                padding: 20px;
                border: 1px solid #1db954;
                backdrop-filter: blur(10px);
            }

            .stat-card h3 {
                color: #1db954;
                margin-bottom: 15px;
                font-size: 1.5rem;
            }

            .big-number {
                font-size: 2.5rem;
                font-weight: bold;
                color: #1db954;
                margin-bottom: 10px;
            }

            .chart-container {
                position: relative;
                height: 300px;
                margin-top: 15px;
            }

            .top-list {
                list-style: none;
                max-height: 300px;
                overflow-y: auto;
            }

            .top-list li {
                padding: 10px;
                margin: 5px 0;
                background: rgba(29, 185, 84, 0.1);
                border-radius: 5px;
                border-left: 3px solid #1db954;
            }

            .rank {
                color: #1db954;
                font-weight: bold;
                margin-right: 10px;
            }

            .time-period {
                margin-bottom: 20px;
            }

            .time-period select {
                background: #191414;
                color: white;
                border: 1px solid #1db954;
                padding: 10px;
                border-radius: 5px;
                font-size: 1rem;
            }

            .progress-bar {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                overflow: hidden;
                height: 20px;
                margin-top: 5px;
            }

            .progress-fill {
                background: #1db954;
                height: 100%;
                transition: width 0.3s ease;
            }

            .error {
                background: rgba(255, 0, 0, 0.2);
                border: 1px solid #ff4444;
                border-radius: 5px;
                padding: 20px;
                margin: 20px 0;
            }

            .file-info {
                background: rgba(29, 185, 84, 0.1);
                border: 1px solid #1db954;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                text-align: left;
            }

            .file-info h4 {
                color: #1db954;
                margin-bottom: 10px;
            }

            @media (max-width: 768px) {
                .header h1 {
                    font-size: 2rem;
                }

                .stats-grid {
                    grid-template-columns: 1fr;
                }

                .upload-container {
                    padding: 20px;
                    margin: 20px auto;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üéµ My Spotify Stats</h1>
                <p>
                    Upload your Spotify data to discover your music listening
                    patterns
                </p>
            </div>

            <!-- Upload View -->
            <div id="uploadView">
                <div class="upload-container" id="dropZone">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">
                        <strong
                            >Upload your Spotify Extended Streaming
                            History</strong
                        >
                        <br />
                        Drop your .zip file here or click to browse
                        <br />
                        <small
                            >Your data is processed locally - nothing is
                            uploaded to any server</small
                        >
                    </div>
                    <input
                        type="file"
                        id="fileInput"
                        class="upload-input"
                        accept=".zip"
                    />
                    <button
                        class="upload-button"
                        onclick="document.getElementById('fileInput').click()"
                    >
                        Choose File
                    </button>
                    <div class="file-info" style="display: none" id="fileInfo">
                        <h4>How to get your Spotify data:</h4>
                        <ol>
                            <li>
                                Go to
                                <a
                                    href="https://www.spotify.com/account/privacy/"
                                    target="_blank"
                                    style="color: #1db954"
                                    >Spotify Privacy Settings</a
                                >
                            </li>
                            <li>Scroll down to "Download your data"</li>
                            <li>Request "Extended streaming history"</li>
                            <li>
                                Wait for Spotify to email you the download link
                                (can take up to 30 days)
                            </li>
                            <li>Download and upload the .zip file here</li>
                        </ol>
                    </div>
                    <button
                        class="upload-button"
                        onclick="toggleFileInfo()"
                        style="background: rgba(255, 255, 255, 0.1)"
                    >
                        üìã How to get my data?
                    </button>
                </div>
            </div>

            <!-- Processing View -->
            <div id="processingView" style="display: none">
                <button class="back-button" onclick="showUploadView()">
                    ‚Üê Back to Upload
                </button>
                <div class="processing">
                    <div>Processing your Spotify data... üé∂</div>
                    <div class="processing-steps">
                        <div class="processing-step" id="step1">
                            üìÅ Extracting ZIP file...
                        </div>
                        <div class="processing-step" id="step2">
                            üîç Finding data files...
                        </div>
                        <div class="processing-step" id="step3">
                            üìä Processing listening history...
                        </div>
                        <div class="processing-step" id="step4">
                            üéµ Generating statistics...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats View -->
            <div id="statsView" style="display: none">
                <button class="back-button" onclick="showUploadView()">
                    ‚Üê Upload New Data
                </button>

                <div class="time-period">
                    <label for="periodSelect">Time Period: </label>
                    <select id="periodSelect">
                        <option value="all">All Time</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="last30">Last 30 Days</option>
                        <option value="last7">Last 7 Days</option>
                    </select>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Listening Time</h3>
                        <div class="big-number" id="totalTime">0h</div>
                        <div id="totalTracks">0 tracks played</div>
                    </div>

                    <div class="stat-card">
                        <h3>Average Daily Listening</h3>
                        <div class="big-number" id="avgDaily">0h</div>
                        <div id="avgTracks">0 tracks per day</div>
                    </div>

                    <div class="stat-card">
                        <h3>Unique Artists</h3>
                        <div class="big-number" id="uniqueArtists">0</div>
                        <div id="uniqueTracks">0 unique tracks</div>
                    </div>

                    <div class="stat-card">
                        <h3>Top Platform</h3>
                        <div class="big-number" id="topPlatform">-</div>
                        <div id="platformStats">Platform breakdown</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Top Artists</h3>
                        <ul class="top-list" id="topArtists"></ul>
                    </div>

                    <div class="stat-card">
                        <h3>Top Tracks</h3>
                        <ul class="top-list" id="topTracks"></ul>
                    </div>

                    <div class="stat-card">
                        <h3>Top Albums</h3>
                        <ul class="top-list" id="topAlbums"></ul>
                    </div>

                    <div class="stat-card">
                        <h3>Listening by Hour</h3>
                        <div class="chart-container">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3>Monthly Listening</h3>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>

                    <div class="stat-card">
                        <h3>Skip Rate Analysis</h3>
                        <div id="skipRate" class="big-number">0%</div>
                        <div>Average completion rate</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="completionBar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error View -->
            <div id="errorView" style="display: none" class="error">
                <h3>Error Processing Data</h3>
                <p id="errorMessage">
                    There was an issue processing your Spotify data.
                </p>
                <button class="upload-button" onclick="showUploadView()">
                    Try Again
                </button>
            </div>
        </div>

        <script>
            let allData = [];
            let filteredData = [];
            let charts = {};

            // View management
            function showUploadView() {
                document.getElementById("uploadView").style.display = "block";
                document.getElementById("processingView").style.display =
                    "none";
                document.getElementById("statsView").style.display = "none";
                document.getElementById("errorView").style.display = "none";

                // Clear previous data
                allData = [];
                filteredData = [];

                // Destroy existing charts
                Object.values(charts).forEach((chart) => chart.destroy());
                charts = {};
            }

            function showProcessingView() {
                document.getElementById("uploadView").style.display = "none";
                document.getElementById("processingView").style.display =
                    "block";
                document.getElementById("statsView").style.display = "none";
                document.getElementById("errorView").style.display = "none";

                // Reset processing steps
                ["step1", "step2", "step3", "step4"].forEach((stepId) => {
                    const step = document.getElementById(stepId);
                    step.classList.remove("active", "completed");
                });
            }

            function showStatsView() {
                document.getElementById("uploadView").style.display = "none";
                document.getElementById("processingView").style.display =
                    "none";
                document.getElementById("statsView").style.display = "block";
                document.getElementById("errorView").style.display = "none";
            }

            function showErrorView(message) {
                document.getElementById("uploadView").style.display = "none";
                document.getElementById("processingView").style.display =
                    "none";
                document.getElementById("statsView").style.display = "none";
                document.getElementById("errorView").style.display = "block";
                document.getElementById("errorMessage").textContent = message;
            }

            function toggleFileInfo() {
                const fileInfo = document.getElementById("fileInfo");
                if (fileInfo.style.display === "none") {
                    fileInfo.style.display = "block";
                } else {
                    fileInfo.style.display = "none";
                }
            }

            function setProcessingStep(stepNumber) {
                // Mark previous steps as completed
                for (let i = 1; i < stepNumber; i++) {
                    const step = document.getElementById(`step${i}`);
                    step.classList.remove("active");
                    step.classList.add("completed");
                }

                // Mark current step as active
                const currentStep = document.getElementById(
                    `step${stepNumber}`,
                );
                currentStep.classList.add("active");
            }

            // File handling
            async function processZipFile(file) {
                try {
                    showProcessingView();
                    setProcessingStep(1);

                    const zip = new JSZip();
                    const contents = await zip.loadAsync(file);

                    setProcessingStep(2);

                    // Find streaming history files
                    const streamingFiles = [];
                    contents.forEach((relativePath, file) => {
                        // Skip macOS metadata files and directories
                        if (
                            relativePath.includes("__MACOSX") ||
                            relativePath.startsWith("._") ||
                            relativePath.includes("/._") ||
                            file.dir
                        ) {
                            return;
                        }

                        if (
                            relativePath.includes("Streaming_History_Audio") &&
                            relativePath.endsWith(".json")
                        ) {
                            console.log(`Found valid file: ${relativePath}`);
                            streamingFiles.push({
                                path: relativePath,
                                file: file,
                            });
                        }
                    });

                    if (streamingFiles.length === 0) {
                        throw new Error(
                            "No Spotify streaming history files found in the ZIP. Make sure you uploaded the Extended Streaming History data.",
                        );
                    }

                    setProcessingStep(3);

                    // Process each file
                    const allRecords = [];
                    console.log(
                        `Processing ${streamingFiles.length} valid streaming history files...`,
                    );

                    for (const { path, file } of streamingFiles) {
                        try {
                            const content = await file.async("text");

                            // Additional check for valid JSON content
                            if (
                                !content.trim().startsWith("[") &&
                                !content.trim().startsWith("{")
                            ) {
                                console.warn(
                                    `Skipping ${path}: Not valid JSON content`,
                                );
                                continue;
                            }

                            const data = JSON.parse(content);
                            if (Array.isArray(data)) {
                                console.log(
                                    `Loaded ${data.length} records from ${path}`,
                                );
                                allRecords.push(...data);
                            } else {
                                console.warn(
                                    `Skipping ${path}: Data is not an array`,
                                );
                            }
                        } catch (e) {
                            console.warn(
                                `Error processing ${path}:`,
                                e.message,
                            );
                        }
                    }

                    // Filter valid records
                    allData = allRecords.filter(
                        (item) =>
                            item.master_metadata_track_name &&
                            item.master_metadata_album_artist_name &&
                            item.ms_played > 0 &&
                            item.ts,
                    );

                    if (allData.length === 0) {
                        throw new Error(
                            "No valid listening records found in the uploaded files.",
                        );
                    }

                    setProcessingStep(4);

                    console.log(
                        `Successfully processed ${allData.length} valid listening records from ${streamingFiles.length} files`,
                    );
                    console.log(
                        `Data spans from ${new Date(Math.min(...allData.map((item) => new Date(item.ts)))).toLocaleDateString()} to ${new Date(Math.max(...allData.map((item) => new Date(item.ts)))).toLocaleDateString()}`,
                    );

                    // Short delay to show final step
                    await new Promise((resolve) => setTimeout(resolve, 500));

                    // Mark final step as completed
                    document.getElementById("step4").classList.remove("active");
                    document.getElementById("step4").classList.add("completed");

                    // Initialize stats view
                    applyFilter("all");
                    showStatsView();
                } catch (error) {
                    console.error("Error processing ZIP file:", error);
                    showErrorView(error.message);
                }
            }

            // Stats functions (same as before but adapted)
            function applyFilter(period) {
                const now = new Date();
                let startDate = new Date(0);

                switch (period) {
                    case "last7":
                        startDate = new Date(
                            now.getTime() - 7 * 24 * 60 * 60 * 1000,
                        );
                        break;
                    case "last30":
                        startDate = new Date(
                            now.getTime() - 30 * 24 * 60 * 60 * 1000,
                        );
                        break;
                    case "2024":
                        startDate = new Date("2024-01-01");
                        break;
                    case "2023":
                        startDate = new Date("2023-01-01");
                        break;
                    case "2022":
                        startDate = new Date("2022-01-01");
                        break;
                    default:
                        startDate = new Date(0);
                }

                filteredData = allData.filter((item) => {
                    const itemDate = new Date(item.ts);
                    return (
                        itemDate >= startDate &&
                        (period === "all" ||
                            (period === "2024" &&
                                itemDate.getFullYear() === 2024) ||
                            (period === "2023" &&
                                itemDate.getFullYear() === 2023) ||
                            (period === "2022" &&
                                itemDate.getFullYear() === 2022) ||
                            period.startsWith("last"))
                    );
                });

                updateStats();
            }

            function updateStats() {
                // Basic stats
                const totalMs = filteredData.reduce(
                    (sum, item) => sum + item.ms_played,
                    0,
                );
                const totalHours = Math.round(totalMs / (1000 * 60 * 60));
                const totalTracks = filteredData.length;

                document.getElementById("totalTime").textContent =
                    `${totalHours}h`;
                document.getElementById("totalTracks").textContent =
                    `${totalTracks.toLocaleString()} tracks played`;

                // Average daily listening
                const days = Math.max(
                    1,
                    Math.ceil(
                        (new Date() -
                            new Date(
                                Math.min(
                                    ...filteredData.map(
                                        (item) => new Date(item.ts),
                                    ),
                                ),
                            )) /
                            (1000 * 60 * 60 * 24),
                    ),
                );
                const avgDailyHours = Math.round((totalHours / days) * 10) / 10;
                const avgDailyTracks = Math.round(totalTracks / days);

                document.getElementById("avgDaily").textContent =
                    `${avgDailyHours}h`;
                document.getElementById("avgTracks").textContent =
                    `${avgDailyTracks} tracks per day`;

                // Unique counts
                const uniqueArtists = new Set(
                    filteredData.map(
                        (item) => item.master_metadata_album_artist_name,
                    ),
                ).size;
                const uniqueTracks = new Set(
                    filteredData.map(
                        (item) =>
                            `${item.master_metadata_track_name}-${item.master_metadata_album_artist_name}`,
                    ),
                ).size;

                document.getElementById("uniqueArtists").textContent =
                    uniqueArtists.toLocaleString();
                document.getElementById("uniqueTracks").textContent =
                    `${uniqueTracks.toLocaleString()} unique tracks`;

                // Platform stats
                const platforms = {};
                filteredData.forEach((item) => {
                    platforms[item.platform] =
                        (platforms[item.platform] || 0) + item.ms_played;
                });

                const topPlatform = Object.keys(platforms).reduce(
                    (a, b) => (platforms[a] > platforms[b] ? a : b),
                    "unknown",
                );
                document.getElementById("topPlatform").textContent =
                    topPlatform;

                // Skip rate
                const completedTracks = filteredData.filter(
                    (item) => item.ms_played > 30000,
                ).length; // 30+ seconds
                const completionRate = Math.round(
                    (completedTracks / totalTracks) * 100,
                );
                document.getElementById("skipRate").textContent =
                    `${completionRate}%`;
                document.getElementById("completionBar").style.width =
                    `${completionRate}%`;

                updateTopLists();
                updateCharts();
            }

            function updateTopLists() {
                // Top Artists
                const artistPlays = {};
                filteredData.forEach((item) => {
                    const artist = item.master_metadata_album_artist_name;
                    artistPlays[artist] =
                        (artistPlays[artist] || 0) + item.ms_played;
                });

                const topArtists = Object.entries(artistPlays)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 10);

                document.getElementById("topArtists").innerHTML = topArtists
                    .map(
                        ([artist, ms], index) =>
                            `<li><span class="rank">${index + 1}.</span>${artist} <br><small>${Math.round(ms / (1000 * 60))} minutes</small></li>`,
                    )
                    .join("");

                // Top Tracks
                const trackPlays = {};
                filteredData.forEach((item) => {
                    const track = `${item.master_metadata_track_name} - ${item.master_metadata_album_artist_name}`;
                    trackPlays[track] = (trackPlays[track] || 0) + 1;
                });

                const topTracks = Object.entries(trackPlays)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 10);

                document.getElementById("topTracks").innerHTML = topTracks
                    .map(
                        ([track, plays], index) =>
                            `<li><span class="rank">${index + 1}.</span>${track} <br><small>${plays} plays</small></li>`,
                    )
                    .join("");

                // Top Albums
                const albumPlays = {};
                filteredData.forEach((item) => {
                    if (item.master_metadata_album_album_name) {
                        const album = `${item.master_metadata_album_album_name} - ${item.master_metadata_album_artist_name}`;
                        albumPlays[album] =
                            (albumPlays[album] || 0) + item.ms_played;
                    }
                });

                const topAlbums = Object.entries(albumPlays)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 10);

                document.getElementById("topAlbums").innerHTML = topAlbums
                    .map(
                        ([album, ms], index) =>
                            `<li><span class="rank">${index + 1}.</span>${album} <br><small>${Math.round(ms / (1000 * 60))} minutes</small></li>`,
                    )
                    .join("");
            }

            function updateCharts() {
                // Hourly listening pattern
                const hourlyData = new Array(24).fill(0);
                filteredData.forEach((item) => {
                    const hour = new Date(item.ts).getHours();
                    hourlyData[hour] += item.ms_played;
                });

                // Destroy existing chart if it exists
                if (charts.hourly) {
                    charts.hourly.destroy();
                }

                const hourlyCtx = document
                    .getElementById("hourlyChart")
                    .getContext("2d");
                charts.hourly = new Chart(hourlyCtx, {
                    type: "bar",
                    data: {
                        labels: Array.from({ length: 24 }, (_, i) => `${i}:00`),
                        datasets: [
                            {
                                label: "Minutes Listened",
                                data: hourlyData.map((ms) =>
                                    Math.round(ms / (1000 * 60)),
                                ),
                                backgroundColor: "#1db954",
                                borderColor: "#1ed760",
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: "rgba(255, 255, 255, 0.1)" },
                                ticks: { color: "#fff" },
                            },
                            x: {
                                grid: { color: "rgba(255, 255, 255, 0.1)" },
                                ticks: { color: "#fff" },
                            },
                        },
                    },
                });

                // Monthly listening pattern
                const monthlyData = {};
                filteredData.forEach((item) => {
                    const date = new Date(item.ts);
                    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}`;
                    monthlyData[monthKey] =
                        (monthlyData[monthKey] || 0) + item.ms_played;
                });

                const sortedMonths = Object.keys(monthlyData).sort();
                const monthlyValues = sortedMonths.map((month) =>
                    Math.round(monthlyData[month] / (1000 * 60 * 60)),
                );

                if (charts.monthly) {
                    charts.monthly.destroy();
                }

                const monthlyCtx = document
                    .getElementById("monthlyChart")
                    .getContext("2d");
                charts.monthly = new Chart(monthlyCtx, {
                    type: "line",
                    data: {
                        labels: sortedMonths,
                        datasets: [
                            {
                                label: "Hours Listened",
                                data: monthlyValues,
                                backgroundColor: "rgba(29, 185, 84, 0.2)",
                                borderColor: "#1db954",
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: "rgba(255, 255, 255, 0.1)" },
                                ticks: { color: "#fff" },
                            },
                            x: {
                                grid: { color: "rgba(255, 255, 255, 0.1)" },
                                ticks: { color: "#fff", maxTicksLimit: 8 },
                            },
                        },
                    },
                });
            }

            // Event listeners
            document
                .getElementById("fileInput")
                .addEventListener("change", function (e) {
                    const file = e.target.files[0];
                    if (file && file.type === "application/zip") {
                        processZipFile(file);
                    } else {
                        showErrorView(
                            "Please select a valid ZIP file containing your Spotify data.",
                        );
                    }
                });

            document
                .getElementById("periodSelect")
                .addEventListener("change", (e) => {
                    applyFilter(e.target.value);
                });

            // Drag and drop functionality
            const dropZone = document.getElementById("dropZone");

            dropZone.addEventListener("dragover", (e) => {
                e.preventDefault();
                dropZone.classList.add("dragover");
            });

            dropZone.addEventListener("dragleave", (e) => {
                e.preventDefault();
                dropZone.classList.remove("dragover");
            });

            dropZone.addEventListener("drop", (e) => {
                e.preventDefault();
                dropZone.classList.remove("dragover");

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === "application/zip") {
                    processZipFile(files[0]);
                } else {
                    showErrorView(
                        "Please drop a valid ZIP file containing your Spotify data.",
                    );
                }
            });

            // Initialize with upload view
            showUploadView();
        </script>
    </body>
</html>
